---
title: "STAT 184 Final Project"
names: "Mackenzie Johnson & Isabella Santori"
output: html_notebook
---

```{r}
# clean up the RStudio environment 
rm(list = ls())

# load all packages
library(mosaic)
library(tidyverse)
library(lubridate)
library(DataComputing)
```

# Research Question: Do specific countries and/or genders perform better than others in Track and Field events at the Olympic Games?

### Load Primary Data Source into RNotebook
```{r}
#Primary Data Soucre
olympicAthleteData <- read.csv(file.choose())
glimpse(olympicAthleteData)
```
This data set contains information about every athlete that has competed in the Olympics. A case is an Olympic athlete and there are 15 variables to describe each athlete and their participation in the Olympics. 

### Load Secondary Data Source into RNotebook
```{r}
library(rvest)
page <- "https://en.wikipedia.org/wiki/List_of_Olympic_records_in_athletics"
tableList <- page %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)

glimpse(tableList[[1]])
glimpse(tableList[[2]])
```
These lists are from Wikipedia and they are a list of both the male and female current olympic records in the track and field events. Each case represents a different event and then has the current record and the athlete who currently hold that record. The tablelist 1 is the male records and the tablelist 2 is the female records. 

# Data Wrangling 
### Regular Expression of Olympic Records table 
```{r}
malerecords<- tableList[[1]]
femalerecords<- tableList[[2]]

malerecords <- 
  malerecords %>%
    filter(grepl(pattern = "\\d*metres$", Event)) %>%
    mutate(Record = ms(Record)) %>%
    mutate(Sex = "M")
malerecords

femalerecords <-
  femalerecords %>%
    filter(grepl(pattern = "\\d*metres$", Event)) %>%
    mutate(Record = ms(Record)) %>%
    mutate(Sex = "F")
femalerecords
```

### Joining Two Data Tables
```{r}
SprintingRecords <-
  malerecords %>%
    full_join(femalerecords)
SprintingRecords
```

### Using Data Verbs on primary data set
```{r}
olympicAthleteData <-
  olympicAthleteData%>%
  select(Name, Sex, Age, Team, Year, Sport, Event, Medal)%>%
  filter(Sport == "Athletics") %>%
  mutate(Name = as.character(Name),
         Sex = as.character(Sex),
         Sport = as.character(Sport),
         Event = as.character(Event),
         Medal = as.character(Medal),
         Team = as.character(Team)) %>%
  filter(grepl(pattern = "\\d*metres$", Event)) %>%
  mutate(Event = (gsub(pattern = "Athletics Women's|Athletics Men's", replacement = "", Event))) %>%
  rename("Athlete(s)" = Name) %>%
  rename("Nation" = Team)

olympicAthleteData
```

### Using Data verbs on secondary data set
```{r}
SprintingRecords <-
  SprintingRecords %>%
  select(Event, Record, Nation, Date, `Athlete(s)`, Sex) %>%
  mutate(Date = mdy(Date),
         Year = year(Date)) %>%
  select(Event, Record, Nation, Year, `Athlete(s)`, Sex) %>%
  mutate(Nation = (gsub(pattern = "\\(.{3}\\)$", replacement = "", Nation))) %>%
  mutate(Medal = "Gold")
  
SprintingRecords
```
### Fix names in secondary data set to match with primary data set
```{r}
SprintingRecords <-
SprintingRecords %>%
  mutate(`Athlete(s)` = gsub(pattern = "Usain Bolt", replacement = "Usain St. Leo Bolt", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "David Rudisha", replacement = "David Lekuta Rudisha", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Noah Ngeny", replacement = "Noah Kiprono Ngeny", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Kenenisa Bekele", replacement = "Kenenisa Bekele Beyecha", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Florence Griffith Joyner", replacement = "Delorez Florence Griffith Joyner", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Marie-José Pérec", replacement = "Marie Jos- Juliana Prec \\(Hontas-\\)", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Nadezhda Olizarenko", replacement = "Nadiya Fedorivna Olizarenko \\(Mushta-\\)", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Paula Ivan", replacement = "Paula Ivan \\(Ilie\\)", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Vivian Cheruiyot", replacement = "Vivian Jepkemoi Cheruiyot", `Athlete(s)`)) %>%
  mutate(`Athlete(s)` = gsub(pattern = "Almaz Ayana", replacement = "Almaz Ayana Eba", `Athlete(s)`))

SprintingRecords
```

### Join primary and secondary data set
```{r}
completeOlympicData<- 
  olympicAthleteData%>%
  full_join(SprintingRecords)%>%
  arrange(Record) %>%
  select(`Athlete(s)`,Sex, Nation, Event, Record, Year, Medal)

completeOlympicData
```

### Making the data glyph ready 
```{r}
AthleteCounts <-
completeOlympicData %>%
  group_by(Nation, Sex) %>%
  summarise(count = n()) %>%
  spread(key = Sex, value = count) %>%
  mutate(TotalAthletes = F + M) %>%
  arrange(desc(TotalAthletes)) %>%
  na.omit()
AthleteCounts

MedalCounts <-
  completeOlympicData %>%
    group_by(Nation, Medal) %>%
    summarise(count = n()) %>%
    spread (key = Medal, value = count) %>%
    mutate(TotalMedals = sum(Bronze + Gold + Silver)) %>%
    select(Bronze, Gold, Silver, TotalMedals) %>% 
    arrange(desc(TotalMedals)) %>%
    na.omit()
MedalCounts

Counts <-
  MedalCounts %>%
    left_join(AthleteCounts)
Counts
```
# Graphics

### Scatter Plot
```{r}
Counts %>%
  ggplot(aes(x = TotalAthletes, y = TotalMedals)) + 
  geom_point(aes(color = Nation)) + 
  geom_smooth(method = lm) +
  theme(legend.position = "right") + 
  labs(title = "Athlete Counts vs. Medal Counts by Nation") 
```
This scatterplot demonstrates that countries with more total track and field athletes tend to earn more total medals. The linear model has a wide confidence band, so the relationship between total athletes and total medals is probably not modelled best by a linear relationship. There are most likely other variables that contribute more significantly to the number of medals that a nation earns. 

### Bar Graph
```{r}
MedalCounts%>%
  filter(TotalMedals > 20) %>%
  ggplot(aes(x = Nation, y = TotalMedals)) +
  geom_bar(stat = "identity", aes(fill = Nation)) +
  labs(title = "Medal Counts by Country") 
```
This bar graph demonstrates that there are certainly countries that have earned more medals in Track and Field events than others. The United States has clearly earned the most medals, but other countries that have performed well in Track and Field at the Olympics are Great Britain, Kenya, and Jamaica. 

